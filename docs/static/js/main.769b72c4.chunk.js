(this["webpackJsonpavrae-bplan-helper"]=this["webpackJsonpavrae-bplan-helper"]||[]).push([[0],{15:function(t,e,n){},16:function(t,e,n){},17:function(t,e,n){"use strict";n.r(e);var c=n(0),a=n(3),r=n.n(a),i=n(9),o=n.n(i),l=(n(15),function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,18)).then((function(e){var n=e.getCLS,c=e.getFID,a=e.getFCP,r=e.getLCP,i=e.getTTFB;n(t),c(t),a(t),r(t),i(t)}))}),s=n(4),u=n(2),b=n(1),j={w:"white",k:"black",e:"grey",r:"#f33",g:"#3c6",b:"#37b",y:"#fd8",p:"#c6a",c:"skyblue",n:"#422",o:"#f80",pk:"#fce"},h=Object.keys(j),d=["w","g","y","c","o","pk"],f=["T","S","M","L","H","G"],p=(Object.keys({o:"open",c:"closed",b:"double",s:"secret"}),n(16),n(7));function O(t){return Object(u.a)(Array(t).keys())}var x="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function g(t){for(var e="";t||!e;)e+=x[t%26],t=Math.floor(t/26);return e}function v(t){for(var e=0,n=0;n<t.length;n++){var c=t[n];e=26*e+x.indexOf(c)}return e}function m(t,e){return g(t)+(e+1)}function y(t,e,n){return t.units.find((function(t){return t.x===e&&t.y===n}))}function w(t){return t.includes(" ")?'"'.concat(t,'"'):t}function k(t){var e=["!i madd ".concat(w(t.type))],n=["Location: ".concat(m(t.x,t.y))];return t.label&&e.push("-name ".concat(w(t.label))),t.colour&&n.push("Color: ".concat(t.colour)),"M"!==t.size&&n.push("Size: ".concat(t.size)),n.length&&e.push('-note "'.concat(n.join(" | "),'"')),e.join(" ")}function C(t,e){var n=t.indexOf(e);return[t.substr(0,n),t.substr(n+e.length)]}function z(t){var e=JSON.parse(t),n=Object.keys(e)[0],c={name:n,width:1,height:1,units:[],walls:[]};return e[n].forEach((function(t){var e=function(t){var e="",n=[],c={},a=!1,r="",i="";function o(){e?"-"===i[0]?r=i:r?(c[r.substr(1)]=i,r=""):n.push(i):e=i,i=""}for(var l=0;l<t.length;l++){var s=t[l];a?'"'===s?a=!1:i+=s:'"'===s?a=!0:" "===s?o():i+=s}return i&&o(),{command:e,args:n,switches:c}}(t),n=e.command,a=e.args,r=e.switches;if(["!i","!init"].includes(n))switch(a[0]){case"effect":r.attack.substr(2).split(" ~ ").forEach((function(t){var e=C(t,": "),n=Object(s.a)(e,2),a=n[0],r=n[1];if("Size"===a){var i=C(r,"x"),o=Object(s.a)(i,2),l=o[0],u=o[1];c.width=parseInt(l,10),c.height=parseInt(u,10)}else"Background"===a&&(c.bg=r)}));break;case"madd":var i=a[1],o=r.name,l="",u=void 0,j="M";r.note.split(" | ").forEach((function(t){var e=C(t,": "),n=Object(s.a)(e,2),c=n[0],a=n[1];"Location"===c?l=a:"Color"===c?u=a:"Size"===c&&(j=a)})),c.units.push(Object(b.a)({type:i,label:o,colour:u,size:j},function(t){for(var e=0;e<t.length;e++)if(-1!=="0123456789".indexOf(t[e])){var n=t.substr(0,e).toUpperCase(),c=t.substr(e);return{x:v(n),y:parseInt(c,10)-1}}return{x:0,y:0}}(l)))}})),c}var M={T:.3,S:.45,M:.5,L:1,H:1.5,G:2};function S(t){var e=t.onClick,n=t.plan,a=t.unit,r=n.gridsize||40,i=a.colour||"r",o=M[a.size],l=o*r,s=(a.x+Math.max(o,.5))*r,u=(a.y+Math.max(o,.5))*r;return Object(c.jsxs)("g",{onClick:function(){return e(a.x,a.y)},children:[Object(c.jsx)("circle",{cx:s,cy:u,r:l-2,stroke:"black",fill:j[i],pointerEvents:"none"}),"w"!==i&&Object(c.jsx)("circle",{cx:s,cy:u,r:l-3,stroke:"white",fill:"transparent",pointerEvents:"none"}),Object(c.jsx)("text",{x:s,y:u,textAnchor:"middle",dominantBaseline:"central",fill:d.includes(i)?"black":"white",fontSize:.6*l,pointerEvents:"none",children:a.label})]})}function B(t){var e=t.onClick,n=t.plan,a=n.gridsize||40,r=n.width*a,i=n.height*a,o=(n.width+2)*a,l=(n.height+2)*a;return Object(c.jsxs)("svg",{className:"MapView",xmlns:"http://www.w3.org/2000/svg",viewBox:"".concat(-a," ").concat(-a," ").concat(o," ").concat(l),children:[Object(c.jsxs)("g",{children:[O(n.width).map((function(t){return Object(c.jsx)("text",{x:a*(t+.5),y:"-20",textAnchor:"middle",dominantBaseline:"central",children:g(t)})})),O(n.height).map((function(t){return Object(c.jsx)("text",{x:"-20",y:a*(t+.5),textAnchor:"middle",dominantBaseline:"central",children:t+1})}))]}),Object(c.jsx)("g",{stroke:"grey",fill:"white",children:O(n.width).map((function(t){return O(n.height).map((function(n){return Object(c.jsx)("rect",{x:a*t,y:a*n,width:a,height:a,onClick:function(){return e(t,n)}})}))}))}),Object(c.jsx)("rect",{x:"0",y:"0",width:r,height:i,stroke:"black",strokeWidth:"2",fill:"transparent",pointerEvents:"none"}),n.units.map((function(t){return Object(c.jsx)(S,{onClick:e,plan:n,unit:t})}))]})}function E(t){var e=t.label,n=t.value,a=t.onChange;return Object(c.jsxs)("tr",{children:[Object(c.jsx)("th",{children:e}),Object(c.jsx)("td",{children:Object(c.jsx)("input",{value:n,onChange:function(t){return a(t.target.value)}})})]})}function N(t){var e=t.label,n=t.value,a=t.onChange;return Object(c.jsxs)("tr",{children:[Object(c.jsx)("th",{children:e}),Object(c.jsx)("td",{children:Object(c.jsx)("input",{type:"number",value:n,onChange:function(t){return a(t.target.valueAsNumber)}})})]})}function P(t){var e=t.empty,n=t.label,a=t.value,r=t.options,i=t.onChange;return Object(c.jsxs)("tr",{children:[Object(c.jsx)("th",{children:n}),Object(c.jsx)("td",{children:Object(c.jsxs)("select",{value:a,onChange:function(t){return i(function(t){if(t!==e)return t}(t.target.value))},children:[e&&Object(c.jsx)("option",{children:e}),r.map((function(t){return Object(c.jsx)("option",{value:t,children:t},t)}))]})})]})}function L(t){var e=t.plan,n=t.setPlan;return Object(c.jsx)("table",{className:"MapSettings",children:Object(c.jsxs)("tbody",{children:[Object(c.jsx)(E,{label:"Name",value:e.name,onChange:function(t){return n(Object(b.a)(Object(b.a)({},e),{},{name:t}))}}),Object(c.jsx)(N,{label:"Width",value:e.width,onChange:function(t){return n(Object(b.a)(Object(b.a)({},e),{},{width:t||1}))}}),Object(c.jsx)(N,{label:"Height",value:e.height,onChange:function(t){return n(Object(b.a)(Object(b.a)({},e),{},{height:t||1}))}}),Object(c.jsx)(E,{label:"BG",value:e.bg||"",onChange:function(t){return n(Object(b.a)(Object(b.a)({},e),{},{bg:t}))}})]})})}function T(t){var e=t.plan,n=t.setPlan,a=t.unit,r=e.units.indexOf(a);function i(t){return n(Object(b.a)(Object(b.a)({},e),{},{units:e.units.map((function(e,n){return r===n?Object(b.a)(Object(b.a)({},e),t):e}))}))}return Object(c.jsxs)("div",{className:"UnitSettings",children:[Object(c.jsx)("button",{onClick:function(){return n(Object(b.a)(Object(b.a)({},e),{},{units:e.units.filter((function(t,e){return e!==r}))}))},children:"Delete"}),Object(c.jsx)("table",{children:Object(c.jsxs)("tbody",{children:[Object(c.jsx)(E,{label:"Label",value:a.label,onChange:function(t){return i({label:t})}}),Object(c.jsx)(E,{label:"Type",value:a.type,onChange:function(t){return i({type:t})}}),Object(c.jsx)(P,{label:"Colour",value:a.colour,empty:"(default)",options:h,onChange:function(t){return i({colour:t})}}),Object(c.jsx)(P,{label:"Size",value:a.size,options:f,onChange:function(t){return i({size:t})}})]})})]})}function A(t){var e=t.plan,n=t.selection,a=t.setPlan,r=n&&y.apply(void 0,[e].concat(Object(u.a)(n)));return Object(c.jsxs)("div",{className:"MapDetails",children:[Object(c.jsx)("button",{onClick:function(){return window.open(function(t){var e="https://otfbm.io/";return(t.startx||t.starty)&&(e+=m(t.startx||0,t.starty||0)+":"),e+="".concat(t.width,"x").concat(t.height),t.gridsize&&(e+="/@c".concat(t.gridsize)),(t.bgx||t.bgy)&&(e+="/@o".concat(t.bgx||0,":").concat(t.bgy||0)),t.walls.length&&(e+="/",t.walls.forEach((function(t){e+="_",t.colour&&(e+="-c"+t.colour),e+=m(t.sx,t.sy),t.door&&(e+="-"+t.door),e+=m(t.ex,t.ey)}))),t.units.forEach((function(t){e+="/"+m(t.x,t.y),"M"!==t.size&&(e+=t.size),e+=t.colour||"r",t.label&&(e+="-"+t.label),t.token&&(e+="~"+t.token,t.noface&&(e+="~"))})),t.bg&&(e+="?bg="+t.bg),e}(e))},children:"Test"}),Object(c.jsx)(L,{plan:e,setPlan:a}),r&&Object(c.jsx)(T,{plan:e,setPlan:a,unit:r})]})}function D(t){var e=t.onChange,n=t.plan,a=t.uvar?function(t){var e=["Size: ".concat(t.width,"x").concat(t.height)];t.bg&&e.push("Background: ".concat(t.bg));var n=[];return n.push("!i add 100 DM -p",'!i effect DM map -attack "||'.concat(e.join(" ~ "),'"')),n.push.apply(n,Object(u.a)(t.units.map(k))),"!uvar Battles "+JSON.stringify(Object(p.a)({},t.name,n))}(n):function(t){var e=["-mapsize ".concat(t.width,"x").concat(t.height)];t.bg&&e.push("-bg ".concat(t.bg));var n=[],c=w(t.name);return n.push("!bplan new ".concat(c),"!bplan map ".concat(c," set ").concat(e.join(" "))),n.push.apply(n,Object(u.a)(t.units.map((function(t){return"!bplan add ".concat(c," ").concat(k(t))})))),n}(n).join("\n");return Object(c.jsx)("textarea",{className:"MapCode",value:a,onChange:function(t){return e(t.target.value)}})}function I(){var t=Object(a.useState)({name:"name",width:5,height:5,units:[],walls:[]}),e=Object(s.a)(t,2),n=e[0],r=e[1],i=Object(a.useState)(),o=Object(s.a)(i,2),l=o[0],j=o[1];return Object(c.jsxs)("div",{className:"MapPlanner",children:[Object(c.jsx)(B,{onClick:function(t,e){var c=l&&y.apply(void 0,[n].concat(Object(u.a)(l)));y(n,t,e)||r(Object(b.a)(Object(b.a)({},n),{},{units:[].concat(Object(u.a)(n.units),[{x:t,y:e,size:(null===c||void 0===c?void 0:c.size)||"M",label:(null===c||void 0===c?void 0:c.label)||"",type:(null===c||void 0===c?void 0:c.type)||"",colour:null===c||void 0===c?void 0:c.colour}])})),j([t,e])},plan:n}),Object(c.jsx)(A,{plan:n,setPlan:r,selection:l}),Object(c.jsx)(D,{onChange:function(t){var e=t.startsWith("!uvar Battles ")?t.substr(14):t;r(z(e))},plan:n,uvar:!0})]})}o.a.render(Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(I,{})}),document.getElementById("root")),l()}},[[17,1,2]]]);
//# sourceMappingURL=main.769b72c4.chunk.js.map